import{u as R,r as f,c as E,a as v,j as e,H as M}from"./app-DZrL6wO1.js";import{A as $,s as k}from"./app-layout-BVNqvqA6.js";import{c as t,t as s}from"./theme-classes-C1o5LvBg.js";import"./app-CSLFruQT.js";import"./utils-CNSwpjVw.js";import"./button-Cr4sDpjN.js";import"./index-hSTZO9jP.js";import"./index-D4D1kMjY.js";import"./index-CYBwx7kR.js";import"./x-FRcdCJN5.js";import"./createLucideIcon-DkMGSA4v.js";import"./index-BNxELNJL.js";function L({data:a,setData:d,domains:c,phases:p,errors:l}){const r=i=>i?.name||i?.title||i?.label||i?.domain_name||`Domain #${i.id}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium",s.text.primary),children:"Project Title"}),e.jsx("input",{type:"text",value:a.title,onChange:i=>d("title",i.target.value),className:t("mt-1 block w-full rounded-md shadow-sm",s.input.base,s.input.focus)}),l?.title&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.title})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium",s.text.primary),children:"Domain"}),e.jsxs("select",{value:a.domain_id,onChange:i=>d("domain_id",i.target.value),className:t("mt-1 block w-full rounded-md shadow-sm",s.input.base,s.input.focus),children:[e.jsx("option",{value:"",children:c?.length?"Select domain":"Loading domains..."}),c?.map(i=>e.jsx("option",{value:i.id,children:r(i)},i.id))]}),l?.domain_id&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.domain_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium",s.text.primary),children:"Implementation Phase"}),e.jsxs("select",{value:a.implementation_phase_id,onChange:i=>d("implementation_phase_id",i.target.value),className:t("mt-1 block w-full rounded-md shadow-sm",s.input.base,s.input.focus),children:[e.jsx("option",{value:"",children:p?.length?"Select phase":"Loading phases..."}),p?.map(i=>e.jsx("option",{value:i.id,children:i.name||i.title},i.id))]}),l?.implementation_phase_id&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.implementation_phase_id})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium",s.text.primary),children:"Description"}),e.jsx("textarea",{value:a.description,onChange:i=>d("description",i.target.value),className:t("mt-1 block w-full rounded-md shadow-sm",s.input.base,s.input.focus),rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium",s.text.primary),children:"Rationale"}),e.jsx("textarea",{value:a.rationale,onChange:i=>d("rationale",i.target.value),className:t("mt-1 block w-full rounded-md shadow-sm",s.input.base,s.input.focus),rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium",s.text.primary),children:"Objectives"}),e.jsx("textarea",{value:a.objectives,onChange:i=>d("objectives",i.target.value),className:t("mt-1 block w-full rounded-md shadow-sm",s.input.base,s.input.focus),rows:3})]})]})]})}function F({data:a,setData:d,errors:c}){const p=(l,r)=>{d(l,r)};return e.jsxs("div",{className:"space-y-6",children:[["proposal","memo","manual"].map(l=>e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium capitalize",s.text.primary),children:l}),e.jsx("input",{type:"file",onChange:r=>p(l,r.target.files?.[0]||null),className:t("mt-1 block w-full text-sm",s.input.base,"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-blue-900/30 file:text-blue-700 dark:file:text-blue-300 hover:file:bg-blue-100 dark:hover:file:bg-blue-900/50"),accept:".pdf,.doc,.docx"}),c?.[l]&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:c[l]})]},l)),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium mb-2",s.text.primary),children:"Supporting Documents (optional)"}),e.jsx("div",{className:"space-y-4",children:a.supporting_documents.map((l,r)=>e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Description",value:l.description,onChange:i=>{const m=[...a.supporting_documents];m[r].description=i.target.value,d("supporting_documents",m)},className:t("block w-full rounded-md shadow-sm",s.input.base,s.input.focus)}),e.jsx("input",{type:"file",onChange:i=>{const m=[...a.supporting_documents];m[r].file=i.target.files?.[0]||null,d("supporting_documents",m)},className:t("block w-full text-sm",s.input.base,"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-blue-900/30 file:text-blue-700 dark:file:text-blue-300 hover:file:bg-blue-100 dark:hover:file:bg-blue-900/50"),accept:".pdf,.doc,.docx"})]}),e.jsx("button",{type:"button",onClick:()=>{d("supporting_documents",a.supporting_documents.filter((i,m)=>m!==r))},className:"mt-1 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Remove"})]},r))}),e.jsx("button",{type:"button",onClick:()=>d("supporting_documents",[...a.supporting_documents,{description:"",file:null}]),className:t("mt-4 inline-flex items-center px-3 py-1.5 border shadow-sm text-sm font-medium rounded-md",s.button.secondary),children:"Add Supporting Document"})]})]})}function I({data:a}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:t("shadow overflow-hidden sm:rounded-lg",s.card.base),children:[e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:t("text-lg font-medium leading-6",s.text.primary),children:"Project Information"})}),e.jsx("div",{className:t("border-t px-4 py-5 sm:px-6",s.border.primary),children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Title"}),e.jsx("dd",{className:t("mt-1 text-sm",s.text.primary),children:a.title})]}),e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Domain"}),e.jsx("dd",{className:t("mt-1 text-sm",s.text.primary),children:a.domain_id})]}),e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Phase"}),e.jsx("dd",{className:t("mt-1 text-sm",s.text.primary),children:a.implementation_phase_id})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Description"}),e.jsx("dd",{className:t("mt-1 text-sm whitespace-pre-wrap",s.text.primary),children:a.description})]})]})})]}),e.jsxs("div",{className:t("shadow overflow-hidden sm:rounded-lg",s.card.base),children:[e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:t("text-lg font-medium leading-6",s.text.primary),children:"Uploaded Documents"})}),e.jsx("div",{className:t("border-t px-4 py-5 sm:px-6",s.border.primary),children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Proposal"}),e.jsx("dd",{className:t("mt-1 text-sm",s.text.primary),children:a.proposal?.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Memo"}),e.jsx("dd",{className:t("mt-1 text-sm",s.text.primary),children:a.memo?.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Manual"}),e.jsx("dd",{className:t("mt-1 text-sm",s.text.primary),children:a.manual?.name})]}),a.supporting_documents.length>0&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Supporting Documents"}),e.jsx("dd",{className:"mt-1 space-y-1",children:a.supporting_documents.map((d,c)=>e.jsxs("div",{className:t("text-sm",s.text.primary),children:[d.description,": ",d.file?.name]},c))})]})]})})]}),e.jsx("div",{className:t("border rounded-md p-4",s.alert.warning),children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-100",children:"Attention Required"}),e.jsx("p",{className:"mt-2 text-sm text-yellow-700 dark:text-yellow-200",children:"Review all information before submitting. After submission edits may be restricted."})]})]})})]})}function Q(){const{props:a}=R(),d=a?.domains??a?.domain_expertise??a?.domainExpertise??[],c=a?.phases??a?.implementation_phases??[],[p,l]=f.useState(d),[r,i]=f.useState(1),[m,_]=f.useState(!1),{data:u,setData:N,post:S,processing:b,errors:w,reset:C}=E({title:"",domain_id:"",implementation_phase_id:"",description:"",rationale:"",objectives:"",proposal:null,memo:null,manual:null,supporting_documents:[]});f.useEffect(()=>{(async()=>{try{const n=await v.get("/proponent/pap/draft");if(n.data?.draft){const o=n.data.draft;C({...u,...o,supporting_documents:o.supporting_documents||[]})}}catch{}})()},[]),f.useEffect(()=>{p.length===0&&v.get("/proponent/domains").then(n=>{const o=n.data?.domains||n.data||[];Array.isArray(o)&&o.length&&l(o)}).catch(()=>{})},[p.length]);const g=[{number:1,name:"Project Information"},{number:2,name:"Document Upload"},{number:3,name:"Review & Submit"}],j=async()=>{const n=new FormData;Object.entries(u).forEach(([o,x])=>{o==="supporting_documents"?x.forEach((h,y)=>{h.file?(n.append(`supporting_documents[${y}][file]`,h.file),n.append(`supporting_documents[${y}][description]`,h.description)):h.description&&n.append(`supporting_documents[${y}][description]`,h.description)}):x instanceof File?n.append(o,x):Array.isArray(x)||n.append(o,x==null?"":String(x))});try{await v.post("/proponent/pap/draft",n)}catch{}},P=async()=>{await j(),i(n=>Math.min(n+1,g.length))},A=async()=>{await j(),i(n=>Math.max(1,n-1))},D=async n=>{n.preventDefault(),await j(),r===3&&m&&S(k("proponent.pap.store"))};return e.jsxs($,{breadcrumbs:[{title:"Dashboard",href:"/proponent/dashboard"},{title:"Submit PAP",href:k("proponent.pap.create")}],children:[e.jsx(M,{title:"Submit PAP"}),e.jsxs("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("nav",{"aria-label":"Progress",children:e.jsx("ol",{role:"list",className:t("border rounded-md divide-y md:flex md:divide-y-0",s.border.primary),children:g.map(n=>e.jsx("li",{className:"relative md:flex-1 md:flex",children:e.jsx("div",{className:`group flex items-center w-full ${r===n.number?"bg-blue-600":r>n.number?"bg-green-600":"dark:bg-slate-700"}`,children:e.jsxs("span",{className:t("px-6 py-4 flex items-center text-sm font-medium",r!==n.number&&r<=n.number?s.text.primary:""),children:[e.jsx("span",{className:`flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full ${r===n.number?"bg-blue-800 text-white":r>n.number?"bg-green-800 text-white":"border-2 border-gray-300 dark:border-slate-600 text-gray-500 dark:text-gray-400"}`,children:r>n.number?e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("span",{children:n.number})}),e.jsx("span",{className:`ml-4 text-sm font-medium ${r>=n.number?"text-white":t("",s.text.secondary)}`,children:n.name})]})})},n.name))})})}),e.jsxs("form",{onSubmit:D,className:t("shadow-sm rounded-lg p-6 space-y-8",s.card.base),children:[r===1&&e.jsx(L,{data:u,setData:N,domains:p,phases:c,errors:w}),r===2&&e.jsx(F,{data:u,setData:N,errors:w}),r===3&&e.jsxs(e.Fragment,{children:[e.jsx(I,{data:u}),e.jsx("div",{className:"mt-6",children:e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:n=>_(n.target.checked),className:t("h-4 w-4 rounded",s.input.base,"text-blue-600 dark:text-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400")}),e.jsx("span",{className:t("text-sm",s.text.primary),children:"I confirm the information is accurate and complete."})]})})]}),e.jsxs("div",{className:"pt-4 flex justify-between",children:[r>1&&e.jsx("button",{type:"button",onClick:A,className:t("inline-flex items-center px-4 py-2 border shadow-sm text-sm font-medium rounded-md",s.button.secondary),children:"Previous"}),r<g.length?e.jsx("button",{type:"button",onClick:P,className:t("ml-auto inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md",s.button.primary),children:"Next"}):e.jsx("button",{type:"submit",disabled:b||!m,className:t("ml-auto inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white",b||!m?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-green-600 hover:bg-green-700 dark:bg-green-600 dark:hover:bg-green-500"),children:b?"Submitting...":"Submit PAP"})]})]})]})]})}export{Q as default};
