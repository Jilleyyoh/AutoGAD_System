import{u as E,r as b,c as F,j as e,H as P,a as $}from"./app-DZrL6wO1.js";import{A as B,s as p}from"./app-layout-BVNqvqA6.js";import{c as t,t as s}from"./theme-classes-C1o5LvBg.js";import{c as _}from"./createLucideIcon-DkMGSA4v.js";import{C as I,X as M}from"./x-FRcdCJN5.js";import{F as j}from"./file-text-BtWhND71.js";import{E as U}from"./eye-DK73xOfc.js";import"./app-CSLFruQT.js";import"./utils-CNSwpjVw.js";import"./button-Cr4sDpjN.js";import"./index-hSTZO9jP.js";import"./index-D4D1kMjY.js";import"./index-CYBwx7kR.js";import"./index-BNxELNJL.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],O=_("MessageCircle",L);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],X=_("Upload",H),Y=[{id:"remarks",label:"Remarks",icon:O},{id:"details",label:"Project Details",icon:I},{id:"documents",label:"Documents",icon:j},{id:"review",label:"Review & Submit",icon:U}];function re(){const{project:n,remarks:k,documents:y,domains:N,phases:f}=E().props,[c,l]=b.useState("remarks"),[o,v]=b.useState([]),[g,w]=b.useState(!1),{data:r,setData:m,processing:C,errors:d}=F({title:n.title,domain_id:n.domain_id,implementation_phase_id:n.implementation_phase_id,description:n.description,rationale:n.rationale,objectives:n.objectives}),D=a=>{a.target.files&&v(i=>[...i,...Array.from(a.target.files||[])])},S=a=>{v(i=>i.filter((x,u)=>u!==a))},R=async a=>{a.preventDefault(),w(!0);try{const i=new FormData;i.append("title",r.title),i.append("domain_id",String(r.domain_id)),i.append("implementation_phase_id",String(r.implementation_phase_id)),i.append("description",r.description),i.append("rationale",r.rationale),i.append("objectives",r.objectives),o.forEach((u,h)=>{i.append(`documents[${h}][file]`,u),i.append(`documents[${h}][type]`,"supporting"),i.append(`documents[${h}][description]`,"")}),(await $.post(p("proponent.pap.revise",n.id),i,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(window.location.href=p("proponent.pap.submissions"))}catch(i){console.error("Error submitting revision:",i),alert("Error submitting revision: "+(i.response?.data?.message||i.message))}finally{w(!1)}},A=N.find(a=>a.id===r.domain_id)?.name||"N/A",T=f.find(a=>a.id===r.implementation_phase_id)?.name||"N/A";return e.jsxs(B,{breadcrumbs:[{title:"Dashboard",href:p("proponent.dashboard")},{title:"Track Submissions",href:p("proponent.pap.submissions")},{title:`${n.project_code} - Revise`,href:"#"}],children:[e.jsx(P,{title:`Revise ${n.project_code}`}),e.jsxs("div",{className:"max-w-6xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:t("text-3xl font-bold",s.text.primary),children:["Revise Submission: ",n.project_code]}),e.jsx("p",{className:t("mt-2 text-sm",s.text.secondary),children:"Please review the evaluator's remarks and make necessary changes to your project details and documents."})]}),e.jsx("div",{className:t("border-b rounded-t-lg",s.border.primary),children:e.jsx("div",{className:"flex gap-8 overflow-x-auto px-6 py-4",children:Y.map(a=>{const i=a.icon,x=c===a.id;return e.jsxs("button",{onClick:()=>l(a.id),className:`flex items-center gap-2 whitespace-nowrap pb-4 px-1 border-b-2 font-medium text-sm transition-colors ${x?t("border-blue-500 text-blue-600 dark:text-blue-400","dark:border-blue-400"):t("border-transparent text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300",s.text.secondary)}`,children:[e.jsx(i,{className:"w-4 h-4"}),a.label]},a.id)})})}),e.jsxs("div",{className:t("rounded-b-lg border border-t-0 p-6",s.card.base),children:[c==="remarks"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:t("text-lg font-semibold mb-4",s.text.primary),children:"Evaluator's Remarks"}),e.jsx("div",{className:t("rounded-lg p-6 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500",s.card.base),children:e.jsx("p",{className:t("text-base whitespace-pre-wrap",s.text.primary),children:k})})]}),e.jsx("div",{className:"flex justify-between",children:e.jsx("button",{type:"button",onClick:()=>l("details"),className:t("px-6 py-2 rounded-lg font-medium",s.button.primary),children:"Next: Review Details"})})]}),c==="details"&&e.jsxs("form",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium mb-2",s.text.primary),children:"Project Title"}),e.jsx("input",{type:"text",value:r.title,onChange:a=>m("title",a.target.value),className:t("w-full rounded-lg shadow-sm",s.input.base,s.input.focus)}),d.title&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.title})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium mb-2",s.text.primary),children:"Domain"}),e.jsx("select",{value:r.domain_id,onChange:a=>m("domain_id",parseInt(a.target.value)),className:t("w-full rounded-lg shadow-sm",s.input.base,s.input.focus),children:N.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))}),d.domain_id&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.domain_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium mb-2",s.text.primary),children:"Implementation Phase"}),e.jsx("select",{value:r.implementation_phase_id,onChange:a=>m("implementation_phase_id",parseInt(a.target.value)),className:t("w-full rounded-lg shadow-sm",s.input.base,s.input.focus),children:f.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))}),d.implementation_phase_id&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.implementation_phase_id})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium mb-2",s.text.primary),children:"Description"}),e.jsx("textarea",{value:r.description,onChange:a=>m("description",a.target.value),rows:4,className:t("w-full rounded-lg shadow-sm",s.input.base,s.input.focus)}),d.description&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium mb-2",s.text.primary),children:"Rationale"}),e.jsx("textarea",{value:r.rationale,onChange:a=>m("rationale",a.target.value),rows:3,className:t("w-full rounded-lg shadow-sm",s.input.base,s.input.focus)})]}),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium mb-2",s.text.primary),children:"Objectives"}),e.jsx("textarea",{value:r.objectives,onChange:a=>m("objectives",a.target.value),rows:3,className:t("w-full rounded-lg shadow-sm",s.input.base,s.input.focus)})]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("button",{type:"button",onClick:()=>l("remarks"),className:t("px-6 py-2 rounded-lg font-medium",s.button.secondary),children:"Back"}),e.jsx("button",{type:"button",onClick:()=>l("documents"),className:t("px-6 py-2 rounded-lg font-medium",s.button.primary),children:"Next: Update Documents"})]})]}),c==="documents"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:t("text-lg font-semibold mb-4",s.text.primary),children:"Current Documents"}),y.length>0?e.jsx("div",{className:"space-y-2",children:y.map(a=>e.jsxs("div",{className:t("flex items-center justify-between p-3 rounded-lg border",s.card.base),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:t("font-medium",s.text.primary),children:a.original_name}),e.jsxs("p",{className:t("text-sm",s.text.secondary),children:["Type: ",a.type]})]})]}),e.jsx("a",{href:a.download_route,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Download"})]},a.id))}):e.jsx("p",{className:t("text-sm",s.text.secondary),children:"No documents uploaded yet."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:t("text-lg font-semibold mb-4",s.text.primary),children:"Add New/Revised Documents"}),e.jsxs("div",{className:t("border-2 border-dashed rounded-lg p-8 text-center",s.border.primary),children:[e.jsx(X,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsxs("label",{className:t("cursor-pointer",s.text.primary),children:[e.jsx("span",{className:"font-medium",children:"Click to upload"})," or drag and drop",e.jsx("input",{type:"file",multiple:!0,onChange:D,className:"hidden",accept:".pdf,.doc,.docx"})]}),e.jsx("p",{className:t("text-sm mt-2",s.text.secondary),children:"PDF, DOC, DOCX up to 10MB"})]}),o.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("h4",{className:t("font-medium",s.text.primary),children:["New Files (",o.length,")"]}),o.map((a,i)=>e.jsxs("div",{className:t("flex items-center justify-between p-3 rounded-lg border",s.card.base),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-green-600"}),e.jsx("p",{className:t("font-medium",s.text.primary),children:a.name})]}),e.jsx("button",{type:"button",onClick:()=>S(i),className:"text-red-600 hover:text-red-800",children:e.jsx(M,{className:"w-5 h-5"})})]},i))]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("button",{type:"button",onClick:()=>l("details"),className:t("px-6 py-2 rounded-lg font-medium",s.button.secondary),children:"Back"}),e.jsx("button",{type:"button",onClick:()=>l("review"),className:t("px-6 py-2 rounded-lg font-medium",s.button.primary),children:"Next: Review & Submit"})]})]}),c==="review"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:t("rounded-lg p-6 bg-gray-50 dark:bg-slate-700/50",s.card.base),children:[e.jsx("h3",{className:t("text-lg font-semibold mb-4",s.text.primary),children:"Summary of Changes"}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Project Code"}),e.jsx("dd",{className:t("mt-1 text-base",s.text.primary),children:n.project_code})]}),e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Title"}),e.jsx("dd",{className:t("mt-1 text-base",s.text.primary),children:r.title})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Domain"}),e.jsx("dd",{className:t("mt-1 text-base",s.text.primary),children:A})]}),e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Phase"}),e.jsx("dd",{className:t("mt-1 text-base",s.text.primary),children:T})]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:t("text-sm font-medium",s.text.secondary),children:"Documents to Upload"}),e.jsx("dd",{className:t("mt-1 text-base",s.text.primary),children:o.length>0?`${o.length} new document(s)`:"No new documents"})]})]})]}),e.jsx("div",{className:t("border rounded-lg p-4",s.alert.info),children:e.jsx("p",{className:t("text-sm",s.text.primary),children:'Once you submit the revised version, it will be sent for re-evaluation. Your project status will return to "For Evaluation".'})}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("button",{type:"button",onClick:()=>l("documents"),className:t("px-6 py-2 rounded-lg font-medium",s.button.secondary),children:"Back"}),e.jsx("form",{onSubmit:R,className:"flex gap-4",children:e.jsx("button",{type:"submit",disabled:g||C,className:t("px-8 py-2 rounded-lg font-medium text-white disabled:opacity-50",s.button.primary),children:g?"Submitting...":"Done Revision"})})]})]})]})]})]})}export{re as default};
