import{r as o,j as e,H as _,L as C,a as h}from"./app-DZrL6wO1.js";import{A as R}from"./app-layout-BVNqvqA6.js";import{V as $}from"./version-info-pquDlwvR.js";import{C as L}from"./chevron-left-DLBjlG0X.js";import{C as b}from"./circle-check-BkHVpkJp.js";import{C as T}from"./circle-alert-A2Xx533H.js";import"./app-CSLFruQT.js";import"./utils-CNSwpjVw.js";import"./button-Cr4sDpjN.js";import"./index-hSTZO9jP.js";import"./index-D4D1kMjY.js";import"./index-CYBwx7kR.js";import"./x-FRcdCJN5.js";import"./createLucideIcon-DkMGSA4v.js";import"./index-BNxELNJL.js";import"./theme-classes-C1o5LvBg.js";import"./clock-uWUX0Jnj.js";function Q({project:s,evaluations:g,average_score:r,evaluation_count:f,interpretations:y}){const[d,p]=o.useState(!1),[m,u]=o.useState(!1),[x,j]=o.useState(""),[c,n]=o.useState(null),N=async()=>{if(confirm("Are you sure you want to approve this evaluation for certification?")){p(!0);try{await h.post(`/admin2/evaluations/${s.id}/consolidate`,{action:"approve",admin_remarks:x}),n({type:"success",text:"Evaluation approved for certification!"}),setTimeout(()=>{window.location.href="/admin2/evaluations"},2e3)}catch(t){n({type:"error",text:t.response?.data?.message||"Failed to approve evaluation"})}finally{p(!1)}}},v=async()=>{if(confirm("Are you sure you want to return this evaluation for review?")){u(!0);try{await h.post(`/admin2/evaluations/${s.id}/consolidate`,{action:"return_for_review",admin_remarks:x}),n({type:"success",text:"Evaluation returned for review!"}),setTimeout(()=>{window.location.href="/admin2/evaluations"},2e3)}catch(t){n({type:"error",text:t.response?.data?.message||"Failed to return evaluation"})}finally{u(!1)}}},w=t=>t?y.find(i=>t>=i.min&&t<=i.max)?.interpretation||"Unknown":"Pending",a=t=>t==null?{bg:"from-gray-50 to-gray-100",border:"border-gray-200",textLabel:"text-gray-600",textValue:"text-gray-900",textSecondary:"text-gray-700",textTertiary:"text-gray-600",icon:"text-gray-600"}:t>=15?{bg:"from-green-50 to-green-100",border:"border-green-200",textLabel:"text-green-600",textValue:"text-green-900",textSecondary:"text-green-700",textTertiary:"text-green-600",icon:"text-green-600"}:t>=8?{bg:"from-blue-50 to-blue-100",border:"border-blue-200",textLabel:"text-blue-600",textValue:"text-blue-900",textSecondary:"text-blue-700",textTertiary:"text-blue-600",icon:"text-blue-600"}:t>=4?{bg:"from-yellow-50 to-yellow-100",border:"border-yellow-200",textLabel:"text-yellow-600",textValue:"text-yellow-900",textSecondary:"text-yellow-700",textTertiary:"text-yellow-600",icon:"text-yellow-600"}:{bg:"from-red-50 to-red-100",border:"border-red-200",textLabel:"text-red-600",textValue:"text-red-900",textSecondary:"text-red-700",textTertiary:"text-red-600",icon:"text-red-600"};return e.jsxs(R,{children:[e.jsx(_,{title:`Review Evaluation - ${s.project_code}`}),e.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(C,{href:"/admin2/evaluations",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(L,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s.project_code}),e.jsx("p",{className:"text-gray-600",children:s.title})]})]})}),c&&e.jsx("div",{className:`mb-6 p-4 rounded-lg ${c.type==="success"?"bg-green-50 border border-green-200 text-green-700":"bg-red-50 border border-red-200 text-red-700"}`,children:c.text}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Project Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Organization"}),e.jsx("p",{className:"mt-1 text-gray-900",children:s.organization})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Proponent"}),e.jsx("p",{className:"mt-1 text-gray-900",children:s.proponent_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Domain"}),e.jsx("p",{className:"mt-1 text-gray-900",children:s.domain})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Phase"}),e.jsx("p",{className:"mt-1 text-gray-900",children:s.phase})]})]}),s.description&&e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-2 text-gray-700",children:s.description})]})]}),e.jsx("div",{className:`bg-gradient-to-r ${a(r).bg} border ${a(r).border} rounded-lg p-8 mb-8`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${a(r).textLabel} uppercase tracking-wide`,children:"Consolidated Average Score"}),e.jsx("p",{className:`text-5xl font-bold ${a(r).textValue} mt-2`,children:r?.toFixed(2)||"N/A"}),e.jsx("p",{className:`text-lg ${a(r).textSecondary} mt-2 font-semibold`,children:w(r)}),e.jsxs("p",{className:`text-sm ${a(r).textTertiary} mt-1`,children:["Based on ",f," completed evaluation(s)"]})]}),e.jsx(b,{className:`w-16 h-16 ${a(r).icon}`})]})}),e.jsx("div",{className:"space-y-6 mb-8",children:g.map((t,k)=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6 pb-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.evaluator_name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.evaluator_email}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Submitted: ",t.completion_date]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`text-3xl font-bold ${a(t.total_score).textValue}`,children:t.total_score?.toFixed(2)}),e.jsx("p",{className:`text-sm ${a(t.total_score).textTertiary} mt-1`,children:t.interpretation})]})]}),t.questionnaire_version&&e.jsx("div",{className:"mb-6 pb-6 border-b",children:e.jsx($,{version:t.questionnaire_version,compact:!0})}),e.jsx("div",{className:"space-y-4 mb-4",children:t.scores_by_category.map((i,A)=>e.jsxs("div",{className:"bg-gray-50 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:i.category_name}),e.jsx("span",{className:"text-sm font-bold text-blue-600",children:i.subtotal.toFixed(2)})]}),e.jsx("div",{className:"space-y-2",children:i.items.map((l,S)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:l.question}),e.jsx("span",{className:"font-medium text-gray-900",children:l.score})]},S))}),i.items.some(l=>l.remarks)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Remarks:"}),e.jsx("p",{className:"text-sm text-gray-700 italic",children:i.items.filter(l=>l.remarks).map(l=>l.remarks).join(" | ")})]})]},A))}),t.final_remarks&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-4",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-900 mb-1",children:"Final Remarks"}),e.jsx("p",{className:"text-sm text-yellow-800",children:t.final_remarks})]})]},t.id))}),s.status==="approved"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Your Decision"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Remarks (Optional)"}),e.jsx("textarea",{value:x,onChange:t=>j(t.target.value),placeholder:"Add any remarks or notes for the consolidation...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:N,disabled:d||m,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:[e.jsx(b,{className:"w-5 h-5"}),d?"Approving...":"Approve for Certification"]}),e.jsxs("button",{onClick:v,disabled:d||m,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:[e.jsx(T,{className:"w-5 h-5"}),m?"Processing...":"Return for Review"]})]})]})]})})]})}export{Q as default};
