import{u as X,r as c,R as q,j as e,H as J,a as L,b as Q}from"./app-DZrL6wO1.js";import{A as W,s as j}from"./app-layout-BVNqvqA6.js";import{c as r,t as s}from"./theme-classes-C1o5LvBg.js";import{C as N}from"./circle-check-BkHVpkJp.js";import{X as f}from"./x-FRcdCJN5.js";import{C as R}from"./circle-alert-A2Xx533H.js";import{C as Y}from"./calendar-BO3DXBkc.js";import{E as k}from"./eye-DK73xOfc.js";import{C as _}from"./clock-uWUX0Jnj.js";import"./app-CSLFruQT.js";import"./utils-CNSwpjVw.js";import"./button-Cr4sDpjN.js";import"./index-hSTZO9jP.js";import"./index-D4D1kMjY.js";import"./index-CYBwx7kR.js";import"./createLucideIcon-DkMGSA4v.js";import"./index-BNxELNJL.js";const m={all:"All",for_evaluation:"For Evaluation",revision:"Revision",approved:"Approved",declined:"Declined",review:"In Review",for_certification:"For Certification",certified:"Certified"};function ve({projects:U}){const{flash:Z}=X().props,[o,F]=c.useState(U),g=typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams,I=g.get("status")||"all",[i,M]=c.useState(I),[d,b]=c.useState({from:g.get("from")??void 0,to:g.get("to")??void 0}),[ee,$]=c.useState(null),[te,B]=c.useState(!1),[se,G]=c.useState([]),[u,S]=c.useState(!1),[C,h]=c.useState(""),[A,x]=c.useState(""),O=[{key:"all",label:m.all},{key:"for_evaluation",label:m.for_evaluation},{key:"revision",label:m.revision},{key:"approved",label:m.approved},{key:"declined",label:m.declined},{key:"review",label:m.review},{key:"for_certification",label:m.for_certification},{key:"certified",label:m.certified}],E=t=>{if(t==="all")return null;switch(t){case"for_evaluation":return 1;case"revision":return 2;case"approved":return 3;case"declined":return 4;case"for_certification":return 5;case"review":return 6;case"certified":return 7;default:return null}},z=()=>{if(i==="all")return o;const t=n=>(n||"").toString().toLowerCase();if(i==="revision")return o.filter(n=>{const l=t(n.status_name);return l==="revision"||l==="revised"||n.status===2});if(i==="for_evaluation")return o.filter(n=>t(n.status_name)==="for_evaluation"||n.status===1);if(i==="approved")return o.filter(n=>t(n.status_name)==="approved"||n.status===3);if(i==="declined")return o.filter(n=>t(n.status_name)==="declined"||n.status===4);if(i==="for_certification")return o.filter(n=>t(n.status_name)==="for_certification");if(i==="certified")return o.filter(n=>t(n.status_name)==="certified");const a=E(i);return a===null?o:Array.isArray(a)?o.filter(n=>a.includes(n.status)):o.filter(n=>n.status===a)},D=async t=>{$(t),S(!0),x("");try{const a=await L.get(`/admin1/assignments/evaluators/${t.domain_id}`);G(a.data),B(!0)}catch(a){console.error("Error fetching evaluators:",a),x("Failed to load evaluators for this domain")}finally{S(!1)}},H=t=>{Q.visit(j("admin1.assignments.show",t.id))},V=async t=>{x("");try{const a=await L.post("/admin1/assignments/reassign-proponent",{project_id:t.id});F(n=>n.map(l=>l.id===t.id?{...l,status:a.data.project.status,evaluator:null,status_name:a.data.project.status_name}:l)),h("Project returned to proponent for revisions"),setTimeout(()=>h(""),3e3)}catch(a){console.error("Failed to reassign to proponent",a),x(a?.response?.data?.message||"Failed to reassign"),setTimeout(()=>x(""),3e3)}},y=z(),P={all:o.length,for_evaluation:o.filter(t=>t.status_name==="for_evaluation"||t.status===1).length,revision:o.filter(t=>t.status_name==="revision"||t.status_name==="revised"||t.status_name==="revision"||t.status===2).length,approved:o.filter(t=>t.status_name==="approved"||t.status===3).length,declined:o.filter(t=>t.status_name==="declined"||t.status===4).length,for_certification:o.filter(t=>t.status_name==="for_certification"||t.status===5).length,certified:o.filter(t=>t.status_name==="certified"||t.status===7).length};q.useEffect(()=>{console.log("DEBUG: Projects loaded:",o),console.log("DEBUG: Active tab:",i),console.log("DEBUG: Status ID for current tab:",E(i)),console.log("DEBUG: Displayed projects:",y),console.log("DEBUG: Status counts:",P)},[o,i]);const T=t=>{switch(t){case"for_evaluation":return{color:"blue",icon:_,bg:"bg-blue-50 dark:bg-blue-900/10",border:"border-blue-200 dark:border-blue-800"};case"revision":return{color:"yellow",icon:R,bg:"bg-yellow-50 dark:bg-yellow-900/10",border:"border-yellow-200 dark:border-yellow-800"};case"approved":return{color:"green",icon:N,bg:"bg-green-50 dark:bg-green-900/10",border:"border-green-200 dark:border-green-800"};case"declined":return{color:"red",icon:f,bg:"bg-red-50 dark:bg-red-900/10",border:"border-red-200 dark:border-red-800"};case"review":return{color:"orange",icon:k,bg:"bg-orange-50 dark:bg-orange-900/10",border:"border-orange-200 dark:border-orange-800"};case"for_certification":return{color:"indigo",icon:_,bg:"bg-indigo-50 dark:bg-indigo-900/10",border:"border-indigo-200 dark:border-indigo-800"};case"certified":return{color:"purple",icon:N,bg:"bg-purple-50 dark:bg-purple-900/10",border:"border-purple-200 dark:border-purple-800"};default:return{color:"gray",icon:k,bg:"bg-gray-50 dark:bg-gray-900/10",border:"border-gray-200 dark:border-gray-800"}}},K=()=>{const t=new URLSearchParams;i&&i!=="all"&&t.set("status",i),d.from&&t.set("from",d.from),d.to&&t.set("to",d.to),window.location.href=j("admin1.assignments.index")+(t.toString()?"?"+t.toString():"")};return e.jsxs(W,{children:[e.jsx(J,{title:"Manage Assignments"}),e.jsxs("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:r("text-4xl font-bold",s.text.primary),children:"Manage Assignments"}),e.jsx("p",{className:r("mt-2 max-w-2xl",s.text.secondary),children:"Assign evaluators to projects and track the evaluation workflow across different statuses"})]}),C&&e.jsxs("div",{className:r("mb-6 p-4 border rounded-lg flex items-center justify-between",s.alert.success),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{children:C})]}),e.jsx("button",{onClick:()=>h(""),className:"text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300",children:e.jsx(f,{className:"w-4 h-4"})})]}),A&&e.jsxs("div",{className:r("mb-6 p-4 border rounded-lg flex items-center justify-between",s.alert.error),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:A})]}),e.jsx("button",{onClick:()=>x(""),className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300",children:e.jsx(f,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:r("rounded-lg border shadow-sm",s.card.base),children:e.jsx("div",{className:"flex flex-wrap justify-center gap-2 p-4 lg:gap-4 lg:p-6",children:O.map(t=>{const{color:a,icon:n,bg:l,border:v}=T(t.key),w=P[t.key],p=i===t.key;return e.jsxs("button",{onClick:()=>M(t.key),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 ${p?`${l} ${v} border-2 text-${a}-700 dark:text-${a}-300 shadow-md`:r("text-gray-600 hover:text-gray-900 border border-transparent",s.text.secondary,"dark:hover:text-gray-300")}`,children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:t.label}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${p?`${a==="blue"?"bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200":a==="green"?"bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200":a==="yellow"?"bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200":a==="purple"?"bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-200":a==="orange"?"bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200":"bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200"}`:r("bg-gray-100 text-gray-600","dark:bg-slate-700 dark:text-gray-400")}`,children:w})]},t.key)})})})}),e.jsxs("div",{className:r("p-6 shadow-sm rounded-lg border mb-6",s.card.base),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:r("w-5 h-5",s.icon.primary)}),e.jsx("h2",{className:r("text-lg font-semibold",s.text.primary),children:"Refine by Date (Optional)"})]}),(d.from||d.to)&&e.jsxs("button",{onClick:()=>{b({from:void 0,to:void 0});const t=new URLSearchParams;i&&i!=="all"&&t.set("status",i),window.location.href=j("admin1.assignments.index")+(t.toString()?"?"+t.toString():"")},className:r("text-sm px-3 py-1 rounded-md",s.button.secondary),children:[e.jsx(f,{className:"w-4 h-4 inline mr-1"}),"Clear Dates"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:r("block text-sm font-medium mb-2",s.text.primary),children:"Start Date"}),e.jsx("input",{type:"date",value:d.from||"",onChange:t=>b({...d,from:t.target.value||void 0}),className:r("block w-full px-4 py-2 rounded-lg border text-sm appearance-none cursor-pointer",s.input.base,s.input.focus)})]}),e.jsxs("div",{children:[e.jsx("label",{className:r("block text-sm font-medium mb-2",s.text.primary),children:"End Date"}),e.jsx("input",{type:"date",value:d.to||"",onChange:t=>b({...d,to:t.target.value||void 0}),className:r("block w-full px-4 py-2 rounded-lg border text-sm appearance-none cursor-pointer",s.input.base,s.input.focus)})]}),e.jsx("div",{className:"md:col-span-1 lg:col-span-1 flex items-end",children:e.jsx("div",{className:r("w-full px-4 py-2 rounded-lg text-sm font-medium text-center",s.text.tertiary),children:d.from&&d.to?`${Math.ceil((new Date(d.to).getTime()-new Date(d.from).getTime())/(1e3*60*60*24))+1} days`:"Date range optional"})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"button",onClick:K,className:r("w-full px-4 py-2 text-sm font-medium rounded-lg shadow-sm transition-all",s.button.primary),children:"Apply Filters"})})]})]}),e.jsx("div",{className:r("shadow-md rounded-lg border overflow-hidden",s.card.base),children:y.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:r("min-w-full divide-y",s.table.border),children:[e.jsx("thead",{className:s.table.header,children:e.jsxs("tr",{children:[e.jsx("th",{className:r("px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",s.text.secondary),children:"Project Code"}),e.jsx("th",{className:r("px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",s.text.secondary),children:"Title"}),e.jsx("th",{className:r("px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",s.text.secondary),children:"Organization"}),e.jsx("th",{className:r("px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",s.text.secondary),children:"Domain"}),e.jsx("th",{className:r("px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",s.text.secondary),children:"Phase"}),e.jsx("th",{className:r("px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",s.text.secondary),children:"Submission"}),e.jsx("th",{className:r("px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",s.text.secondary),children:"Status"}),e.jsx("th",{className:r("px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",s.text.secondary),children:"Evaluator"}),e.jsx("th",{className:r("px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",s.text.secondary),children:"Actions"})]})}),e.jsx("tbody",{className:r("divide-y",s.table.border),children:y.map(t=>e.jsxs("tr",{className:s.table.row,children:[e.jsx("td",{className:r("px-6 py-4 whitespace-nowrap text-sm font-medium",s.text.primary),children:t.project_code}),e.jsx("td",{className:r("px-6 py-4 text-sm",s.text.primary),children:e.jsx("div",{className:"max-w-xs truncate",title:t.title,children:t.title})}),e.jsx("td",{className:r("px-6 py-4 whitespace-nowrap text-sm",s.text.secondary),children:t.proponent?.organization?.name??"N/A"}),e.jsx("td",{className:r("px-6 py-4 whitespace-nowrap text-sm",s.text.secondary),children:t.domainExpertise?.name??"N/A"}),e.jsx("td",{className:r("px-6 py-4 whitespace-nowrap text-sm",s.text.secondary),children:t.implementationPhase?.name??"N/A"}),e.jsx("td",{className:r("px-6 py-4 whitespace-nowrap text-sm",s.text.secondary),children:new Date(t.submission_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(()=>{const a=t.status_name||"",{color:n,icon:l,bg:v,border:w}=T(a);return e.jsxs("span",{className:r("inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold",v,w,"border"),children:[e.jsx(l,{className:"w-3 h-3"}),m[a]||(a?a.split("_").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" "):"Unknown")]})})()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t.evaluator?e.jsx("span",{className:r("inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",s.badge.blue),children:t.evaluator.name}):e.jsx("span",{className:r("inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",s.badge.yellow),children:"Not Assigned"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>H(t),className:r("inline-flex items-center px-3 py-2 border text-sm font-medium rounded-md transition-colors",s.button.secondary),title:"View Project Details",children:e.jsx(k,{className:"w-4 h-4"})}),[3,4,5,6,7].includes(t.status)?e.jsx("span",{className:r("inline-flex items-center px-4 py-2 text-sm font-medium rounded-md",t.status===4?s.badge.red:s.badge.green),children:t.status===4?"Declined":"Completed"}):t.status_name==="revision"?e.jsx("button",{onClick:()=>V(t),disabled:u,className:r("inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",s.button.primary),children:u?"Processing...":"Reassign to Proponent"}):t.status_name==="revised"?e.jsx("button",{onClick:()=>D(t),disabled:u,className:r("inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",s.button.primary),children:u?"Loading...":"Reassign"}):e.jsx("button",{onClick:()=>D(t),disabled:u,className:r("inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",s.button.primary),children:u?"Loading...":"Assign"})]})})]},t.id))})]})}):e.jsxs("div",{className:r("px-6 py-16 text-center",s.text.secondary),children:[e.jsx(_,{className:r("w-12 h-12 mx-auto mb-3",s.icon.muted)}),e.jsx("p",{className:r("text-lg font-medium",s.text.primary),children:"No projects in this status"}),e.jsx("p",{className:r("text-sm mt-1",s.text.tertiary),children:"Try selecting a different status filter"})]})})]})]})}export{ve as default};
