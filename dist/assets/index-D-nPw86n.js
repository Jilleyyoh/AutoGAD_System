import{u as M,r as l,j as e,H as L,L as E,a as j}from"./app-DZrL6wO1.js";import{A,s as i,M as v}from"./app-layout-BVNqvqA6.js";import{c as t,t as s}from"./theme-classes-C1o5LvBg.js";import{P as _}from"./plus-D7b07MKU.js";import{S as F}from"./search-DiRNiSRA.js";import{C as P}from"./clock-uWUX0Jnj.js";import{X as D}from"./x-FRcdCJN5.js";import"./app-CSLFruQT.js";import"./utils-CNSwpjVw.js";import"./button-Cr4sDpjN.js";import"./index-hSTZO9jP.js";import"./index-D4D1kMjY.js";import"./index-CYBwx7kR.js";import"./createLucideIcon-DkMGSA4v.js";import"./index-BNxELNJL.js";function V(){const{conversations:N}=M().props,[p,w]=l.useState(""),[C,c]=l.useState(!1),[r,x]=l.useState(""),[o,h]=l.useState(""),[m,u]=l.useState(!1),[g,S]=l.useState(N.data),b=g.filter(a=>a.subject?.toLowerCase().includes(p.toLowerCase())),k=async()=>{if(!r.trim()||!o.trim()){alert("Please fill in both subject and message");return}u(!0);try{console.log("Creating conversation with subject:",r);const a=await j.post(i("proponent.conversations.store"),{subject:r,message:o});if(console.log("Conversation created, response:",a.data),a.data?.conversation_id){const f=a.data.conversation_id;console.log("Fetching conversation:",f);try{const n=i("proponent.conversations.api.show",f);console.log("Fetching from URL:",n);const y=await j.get(n);console.log("Fetched conversation:",y.data);const d=y.data;d&&d.id?(console.log("Adding new conversation to list"),S([d,...g]),console.log("List updated")):console.error("Invalid conversation data:",d)}catch(n){console.error("Error fetching new conversation:",n),console.error("Error details:",n.response?.data||n.message),window.location.reload()}}x(""),h(""),c(!1)}catch(a){console.error("Error creating conversation:",a),alert("Failed to create conversation: "+(a.response?.data?.message||a.message))}finally{u(!1)}};return e.jsxs(A,{breadcrumbs:[{title:"Dashboard",href:i("proponent.dashboard")},{title:"Messages",href:i("proponent.conversations.index")}],children:[e.jsx(L,{title:"Messages"}),e.jsxs("div",{className:"max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:t("text-3xl font-bold",s.text.primary),children:"Messages"}),e.jsx("p",{className:t("mt-1",s.text.secondary),children:"Communicate with Admin support"})]}),e.jsxs("button",{onClick:()=>c(!0),className:t("inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium gap-2",s.button.primary),children:[e.jsx(_,{className:"w-4 h-4"}),"New Message"]})]}),e.jsxs("div",{className:t("relative",""),children:[e.jsx(F,{className:t("absolute left-3 top-3 w-5 h-5",s.text.tertiary)}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:p,onChange:a=>w(a.target.value),className:t("w-full pl-10 pr-4 py-2 border rounded-lg",s.border.primary,s.text.primary)})]}),e.jsx("div",{className:t("space-y-3 border rounded-lg overflow-hidden",s.border.primary),children:b.length>0?b.map(a=>e.jsx(E,{href:i("proponent.conversations.show",a.id),className:t("block p-4 border-b hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors",s.border.primary),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx(v,{className:t("w-5 h-5 mt-1 flex-shrink-0",s.text.secondary)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:t("font-medium truncate",s.text.primary),children:a.subject||"Untitled"}),e.jsx("p",{className:t("text-sm truncate",s.text.secondary),children:a.messages[0]?.message||"No messages"})]})]}),e.jsxs("div",{className:t("flex items-center gap-1 flex-shrink-0",s.text.tertiary),children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("time",{className:"text-sm whitespace-nowrap",children:new Date(a.created_at).toLocaleDateString()})]})]})},a.id)):e.jsxs("div",{className:t("p-8 text-center",s.text.tertiary),children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg",children:"No conversations yet"}),e.jsx("p",{className:t("text-sm mt-2",s.text.secondary),children:"Start a new message to get help from Admin support"})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:t("w-full max-w-2xl rounded-lg shadow-lg",s.card.base),children:[e.jsxs("div",{className:t("flex items-center justify-between p-6 border-b",s.border.primary),children:[e.jsx("h2",{className:t("text-xl font-bold",s.text.primary),children:"New Message"}),e.jsx("button",{onClick:()=>c(!1),className:t("p-1 hover:bg-gray-100 dark:hover:bg-slate-700 rounded",""),children:e.jsx(D,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium mb-2",s.text.secondary),children:"Subject *"}),e.jsx("input",{type:"text",value:r,onChange:a=>x(a.target.value),placeholder:"What is your message about?",className:t("w-full px-4 py-2 border rounded-lg",s.border.primary,s.text.primary)})]}),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-sm font-medium mb-2",s.text.secondary),children:"Message *"}),e.jsx("textarea",{value:o,onChange:a=>h(a.target.value),placeholder:"Type your message here...",rows:6,className:t("w-full px-4 py-2 border rounded-lg resize-none",s.border.primary,s.text.primary)}),e.jsxs("p",{className:t("text-xs mt-1",s.text.tertiary),children:[o.length," characters"]})]})]}),e.jsxs("div",{className:t("flex items-center justify-end gap-3 p-6 border-t",s.border.primary),children:[e.jsx("button",{onClick:()=>c(!1),className:t("px-4 py-2 rounded-lg font-medium border",s.border.primary,s.text.primary,"hover:bg-gray-100 dark:hover:bg-slate-700"),children:"Cancel"}),e.jsx("button",{onClick:k,disabled:m||!r.trim()||!o.trim(),className:t("px-6 py-2 rounded-lg font-medium",m||!r.trim()||!o.trim()?"bg-gray-300 dark:bg-gray-600 text-gray-500 cursor-not-allowed":s.button.primary),children:m?"Sending...":"Send Message"})]})]})})]})]})}export{V as default};
